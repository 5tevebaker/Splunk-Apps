<view template="dashboard.html" stylesheet="threat_overview.css">
    <label>Threat Details</label>
    <module name="AccountBar" layoutPanel="appHeader"/>
    <module name="AppBar" layoutPanel="navigationHeader"/>
    <module name="Message" layoutPanel="messaging">
        <param name="filter">*</param>
        <param name="clearOnJobDispatch">False</param>
        <param name="maxSize">1</param>
    </module>
    <module name="TitleBar" layoutPanel="viewHeader">
        <param name="actionsMenuFilter">dashboard</param>
    </module>
    <module name="GenericHeader" layoutPanel="panel_row1_col1_grp1">
        <param name="label">Threat Details</param>
    </module>
    <module name="StaticContentSample" layoutPanel="panel_row1_col1_grp1">
        <param name="text">This dashboard provides additional detail on traffic generated by activities related to threats.
        </param>
    </module>
    <!--
    Bytes By dst_hostname
    Bytes by User

    Table: stats sum(bytes) sum(elapsed_time) by user, application dst_hostname
    -->
        <module name="ExtendedFieldSearch" layoutPanel="panel_row2_col1_grp1">
            <param name="label">Threat:</param>
            <param name="field">threat</param>
            <param name="replacementMap">
                <param name="arg">
                    <param name="threat">
                        <param name="value"></param>
                    </param>
                </param>
            </param>
            <param name="intention">
                <param name="name">stringreplace</param>
                <param name="arg">
                    <param name="threat">
                        <param name="prefix">Threat="</param>
                        <param name="suffix">"</param>
                        <param name="fillOnEmpty">False</param>
                    </param>
                </param>
            </param>

            <module name="ExtendedFieldSearch" layoutPanel="panel_row2_col1_grp2">
                <param name="label">User:</param>
                <param name="field">user</param>
                <param name="replacementMap">
                    <param name="arg">
                        <param name="user">
                            <param name="value"></param>
                        </param>
                    </param>
                </param>
                <param name="intention">
                    <param name="name">stringreplace</param>
                    <param name="arg">
                        <param name="user">
                            <param name="prefix">User="</param>
                            <param name="suffix">"</param>
                            <param name="fillOnEmpty">False</param>
                        </param>
                    </param>
                </param>

                <module name="ExtendedFieldSearch" layoutPanel="panel_row2_col1_grp3">
                    <param name="label">Application:</param>
                    <param name="field">application</param>
                    <param name="replacementMap">
                        <param name="arg">
                            <param name="application">
                                <param name="value"></param>
                            </param>
                        </param>
                    </param>
                    <param name="intention">
                        <param name="name">stringreplace</param>
                        <param name="arg">
                            <param name="application">
                                <param name="prefix">Application="</param>
                                <param name="suffix">"</param>
                                <param name="fillOnEmpty">False</param>
                            </param>
                        </param>
                    </param>

                    <module name="ExtendedFieldSearch" layoutPanel="panel_row2_col1_grp4">
                        <param name="label">Location:</param>
                        <param name="field">location</param>
                        <param name="replacementMap">
                            <param name="arg">
                                <param name="location">
                                    <param name="value"></param>
                                </param>
                            </param>
                        </param>
                        <param name="intention">
                            <param name="name">stringreplace</param>
                            <param name="arg">
                                <param name="location">
                                    <param name="prefix">Location="</param>
                                    <param name="suffix">"</param>
                                    <param name="fillOnEmpty">False</param>
                                </param>
                            </param>
                        </param>

                        <module name="TimeRangePicker" layoutPanel="panel_row1_col1_grp1" autoRun="True">
                            <param name="selected">Last 60 minutes</param>
                            <param name="searchWhenChanged">True</param>
                            <module name="ViewRedirectorLink">
                                <param name="viewTarget">flashtimeline</param>
                                <param name="label">View Full Report</param>
                            </module>

                            <module name="HiddenSearch" layoutPanel="panel_row3_col1" autoRun="True">
                                <param name="search">
                                    | `tstats` count(Location) from pan_threatDetail where * $threat$ $user$ $application$ $location$ groupby Location Bytes| eval KB=Bytes/1024 |
                                    stats sum(KB) as "Total Bytes (KB)" by Location |
                                    sort -"Total Bytes (KB)"
                                </param>
                                <module name="HiddenChartFormatter">
                                    <param name="chartTitle">Top Locations by KBytes</param>
                                    <param name="chart">pie</param>
                                    <param name="legend.placement">bottom</param>
                                    <param name="charting.chart.sliceCollapsingThreshold">0</param>
                                    <param name="charting.data.count">15</param>
                                    <module name="JSChart">
                                        <param name="width">100%</param>
                                        <param name="height">250px</param>
                                        <param name="enableResize">False</param>
                                        <module name="SimpleDrilldown">
                                            <param name="links">
                                                <param name="*">
                                                    threat_detail?form.location=$click.value$
                                                </param>
                                            </param>
                                        </module>
                                    </module>
                                </module>
                            </module>
                            <module name="HiddenSearch" layoutPanel="panel_row3_col2" autoRun="True">
                                <param name="search">| `tstats` count(User) from pan_threatDetail where * $threat$ $user$ $application$ $location$ groupby User Bytes|
                                    eval KB=Bytes/1024 |
                                    stats sum(KB) as "Transferred (KB)" by User |
                                    sort -"Transferred (KB)"
                                </param>
                                <module name="HiddenChartFormatter">
                                    <param name="chartTitle">Top Users by KBytes Transferred</param>
                                    <param name="chart">pie</param>
                                    <param name="legend.placement">bottom</param>
                                    <param name="charting.chart.sliceCollapsingThreshold">0</param>
                                    <param name="charting.data.count">15</param>
                                    <module name="JSChart">
                                        <param name="width">100%</param>
                                        <param name="height">250px</param>
                                        <param name="enableResize">False</param>
                                        <module name="SimpleDrilldown">
                                            <param name="links">
                                                <param name="*">
                                                    threat_detail?form.user=$click.value$
                                                </param>
                                            </param>
                                        </module>
                                    </module>
                                </module>
                            </module>

                            <module name="GenericHeader" layoutPanel="panel_row4_col1">
                                <param name="label">Bytes Transferred and Duration by users</param>
                            </module>
                            <module name="HiddenSearch" layoutPanel="panel_row4_col1" autoRun="True">
                                <param name="search">| `tstats` count(User) from pan_threatDetail where * $threat$ $user$ $application$ $location$ groupby User Bytes Duration Application Location|
                                    eval KB=Bytes/1024 |
                                    stats sum(KB) as "Transfer (KB)"
                                          sum(Duration) as "Total Duration"
                                       by User Application Location
                                </param>
                                <module name="Paginator">
                                    <param name="entityName">results</param>
                                    <module name="SimpleResultsTable"/>
                                </module>
                            </module>

                            <module name="GenericHeader" layoutPanel="panel_row5_col1">
                                <param name="label">Threats by Bytes Transferred and Sessions</param>
                            </module>
                            <module name="HiddenSearch" layoutPanel="panel_row5_col1" autoRun="True">
                                <param name="search">| `tstats` count(Session) from pan_threatDetail where * $threat$ $user$ $application$ $location$ groupby Session Bytes Threat|
                                    eval KB=Bytes/1024 |
                                    stats sum(KB) as "Transfer (KB)"
                                    count(Session) as "Total Sessions"
                                    by Threat
                                </param>
                                <module name="Paginator">
                                    <param name="entityName">results</param>
                                    <module name="SimpleResultsTable">
                                        <param name="drilldown">row</param>
                                        <module name="SimpleDrilldown">
                                            <param name="links">
                                                <param name="*">
                                                    threat_detail?form.threat=$click.value$
                                                </param>
                                            </param>
                                        </module>
                                    </module>
                                </module>
                            </module>
                        </module>
                    </module>
                </module>
            </module>
        </module>
</view>