<view template="dashboard.html" stylesheet="wildfire_overview.css">
    <label>WildFire Dashboard</label>
    <module name="AccountBar" layoutPanel="appHeader"/>
    <module name="AppBar" layoutPanel="navigationHeader"/>
    <module name="Message" layoutPanel="messaging">
        <param name="filter">*</param>
        <param name="clearOnJobDispatch">False</param>
        <param name="maxSize">1</param>
    </module>
    <module name="TitleBar" layoutPanel="viewHeader">
        <param name="actionsMenuFilter">dashboard</param>
    </module>
    <module name="GenericHeader" layoutPanel="panel_row1_col1">
        <param name="label">WildFire Dashboard</param>
    </module>
    <module name="StaticContentSample" layoutPanel="panel_row1_col1">
        <param name="text">This dashboard provides visibility into WildFire activity in your Palo Alto Networks
            environment. WildFire data is collected from the firewall logs and the WildFire Cloud.  Data can be filtered by type using the form fields.
        </param>
    </module>

        <module name="TimeRangePicker" layoutPanel="panel_row1_col1" autoRun="True">
            <param name="selected">Last 60 minutes</param>
            <param name="searchWhenChanged">True</param>
            <module name="ViewRedirectorLink">
                <param name="viewTarget">flashtimeline</param>
                <param name="label">View Full Report</param>
            </module>
            <module name="ExtendedFieldSearch" layoutPanel="panel_row1_col2_grp1">
                <param name="label">Source IP:</param>
                <param name="field">src_ip</param>
                <param name="replacementMap">
                    <param name="arg">
                        <param name="src_ip">
                            <param name="value"></param>
                        </param>
                    </param>
                </param>
                <param name="intention">
                    <param name="name">stringreplace</param>
                    <param name="arg">
                        <param name="src_ip">
                            <param name="prefix">src_ip="</param>
                            <param name="suffix">"</param>
                            <param name="fillOnEmpty">False</param>
                        </param>
                    </param>
                </param>
                <module name="ExtendedFieldSearch" layoutPanel="panel_row1_col2_grp1">
                    <param name="label">Destination IP:</param>
                    <param name="field">dst_ip</param>
                    <param name="replacementMap">
                        <param name="arg">
                            <param name="dst_ip">
                                <param name="value"></param>
                            </param>
                        </param>
                    </param>
                    <param name="intention">
                        <param name="name">stringreplace</param>
                        <param name="arg">
                            <param name="dst_ip">
                                <param name="prefix">dst_ip="</param>
                                <param name="suffix">"</param>
                                <param name="fillOnEmpty">false</param>
                            </param>
                        </param>
                    </param>
                    <module name="ExtendedFieldSearch" layoutPanel="panel_row1_col2_grp1">
                        <param name="label">User:</param>
                        <param name="field">dst_user</param>
                        <param name="replacementMap">
                            <param name="arg">
                                <param name="dst_user">
                                    <param name="value"></param>
                                </param>
                            </param>
                        </param>
                        <param name="intention">
                            <param name="name">stringreplace</param>
                            <param name="arg">
                                <param name="dst_user">
                                    <param name="prefix">dst_user="</param>
                                    <param name="suffix">"</param>
                                    <param name="fillOnEmpty">false</param>
                                </param>
                            </param>
                        </param>
                        <module name="ExtendedFieldSearch" layoutPanel="panel_row1_col2_grp2">
                            <param name="label">App:</param>
                            <param name="field">app</param>
                            <param name="replacementMap">
                                <param name="arg">
                                    <param name="app">
                                        <param name="value"></param>
                                    </param>
                                </param>
                            </param>
                            <param name="intention">
                                <param name="name">stringreplace</param>
                                <param name="arg">
                                    <param name="app">
                                        <param name="prefix">app="</param>
                                        <param name="suffix">"</param>
                                        <param name="fillOnEmpty">false</param>
                                    </param>
                                </param>
                            </param>
                            <module name="ExtendedFieldSearch" layoutPanel="panel_row1_col2_grp2">
                                <param name="label">Filename:</param>
                                <param name="field">misc</param>
                                <param name="replacementMap">
                                    <param name="arg">
                                        <param name="misc">
                                            <param name="value"></param>
                                        </param>
                                    </param>
                                </param>
                                <param name="intention">
                                    <param name="name">stringreplace</param>
                                    <param name="arg">
                                        <param name="misc">
                                            <param name="default"></param>
                                            <param name="prefix">misc="</param>
                                            <param name="suffix">"</param>
                                            <param name="fillOnEmpty">false</param>
                                        </param>
                                    </param>
                                </param>
                                <module name="ExtendedFieldSearch" layoutPanel="panel_row1_col2_grp2">
                                    <param name="label">Virtual System:</param>
                                    <param name="field">vsys</param>
                                    <param name="replacementMap">
                                        <param name="arg">
                                            <param name="vsys">
                                                <param name="value"></param>
                                            </param>
                                        </param>
                                    </param>
                                    <param name="intention">
                                        <param name="name">stringreplace</param>
                                        <param name="arg">
                                            <param name="vsys">
                                                <param name="prefix">vsys="</param>
                                                <param name="suffix">"</param>
                                                <param name="fillOnEmpty">false</param>
                                            </param>
                                        </param>
                                    </param>
                                        <module name="HiddenSearch" layoutPanel="panel_row2_col1">
                                            <param name="search">| tstats count(action) AS cact FROM pan_wildfire WHERE * $src_ip$ $dst_ip$ $dst_user$ $misc$ $vsys$ $app$ groupby _time action span=5m | timechart values(cact) by action</param>
                                            <module name="HiddenChartFormatter">
                                                <param name="chartTitle">All WildFire Events by Action</param>
                                                <param name="chart">column</param>
                                                <param name="chart.stackMode">stacked</param>
                                                <param name="legend.placement">bottom</param>
                                                <module name="JSChart">
                                                    <param name="width">100%</param>
                                                    <module name="SimpleDrilldown">
                                                        <param name="links">
                                                            <param name="*">./flashtimeline?earliest=$earliest$&amp;latest=$latest$&amp;q=`pan_wildfire`"</param>
                                                        </param>
                                                    </module>
                                                </module>
                                            </module>
                                        </module>
                                        <module name="HiddenSearch" layoutPanel="panel_row2_col2" group="Recent Malware Download Attempts">
                                          <param name="search">|`tstats` count(dst_user) AS ca FROM pan_wildfire WHERE * category="malicious" $src_ip$ $dst_ip$ $dst_user$ $misc$ $vsys$ $app$ groupby _time dst_ip misc dst_user | table _time dst_ip dst_user misc |
                                            rename dst_user AS "Destination User" |
                                            rename dst_ip AS "Destination IP" |
                                            rename action AS Action |
                                            rename misc AS Filename</param>
                                            <module name="Paginator">
                                                <param name="count">7</param>
                                                <param name="entityName">results</param>
                                                <module name="SimpleResultsTable">
                                                  <param name="allowTransformedFieldSelect">True</param>
                                                  <param name="drilldown">all</param>
                                                  <module name="SimpleDrilldown">
                                                    <param name="links">
                                                      <param name="*">./flashtimeline?earliest=$earliest$&amp;latest=$latest$&amp;q=`pan_index` dst_user="$row.Destination User$" dst_ip="$row.Destination IP$" misc="$row.Filename$"</param>
                                                    </param>
                                                  </module>
                                                </module>
                                            </module>
                                        </module>
                                        <module name="HiddenSearch" layoutPanel="panel_row4_col1">
                                            <param name="search">| tstats count(misc) AS cti FROM pan_wildfire WHERE * category="malicious" $src_ip$ $dst_ip$ $dst_user$ $misc$ $vsys$ $app$ groupby misc</param>
                                            <module name="HiddenChartFormatter">
                                                <param name="chartTitle">Top Malware</param>
                                                <param name="chart">pie</param>
                                                <param name="legend.placement">bottom</param>
                                                <module name="JSChart">
                                                    <param name="width">100%</param>
                                                    <param name="height">250px</param>
                                                    <module name="SimpleDrilldown">
                                                        <param name="links">
                                                            <param name="*">
                                                                wildfire_overview?earliest=$earliest$&amp;latest=$latest$&amp;form.misc=$click.value$
                                                            </param>
                                                        </param>
                                                    </module>
                                                </module>
                                            </module>
                                        </module>
                                        <module name="HiddenSearch" layoutPanel="panel_row4_col2">
                                            <param name="search">| tstats count(app) AS ca FROM pan_wildfire WHERE * category="malicious" $src_ip$ $dst_ip$ $dst_user$ $misc$ $vsys$ $app$ groupby app</param>
                                            <module name="HiddenChartFormatter">
                                                <param name="chartTitle">Malware Downloads by App</param>
                                                <param name="chart">pie</param>
                                                <param name="legend.placement">bottom</param>
                                                <module name="JSChart">
                                                    <param name="width">100%</param>
                                                    <param name="height">250px</param>
                                                    <module name="SimpleDrilldown">
                                                        <param name="links">
                                                            <param name="*">
                                                                wildfire_overview?earliest=$earliest$&amp;latest=$latest$&amp;form.application=$click.value$
                                                            </param>
                                                        </param>
                                                    </module>
                                                </module>
                                            </module>
                                        </module>
                                        <module name="HiddenSearch" layoutPanel="panel_row4_col3">
                                            <param name="search">| tstats count(dst_user) AS cti FROM pan_wildfire WHERE * category="malicious" $src_ip$ $dst_ip$ $dst_user$ $misc$ $vsys$ $app$ $dst_user$ groupby dst_user </param>
                                            <module name="HiddenChartFormatter">
                                                <param name="chartTitle">Malware Downloaders by User</param>
                                                <param name="chart">pie</param>
                                                <param name="legend.placement">bottom</param>
                                                <module name="JSChart">
                                                    <param name="width">100%</param>
                                                    <param name="height">250px</param>
                                                    <module name="SimpleDrilldown">
                                                        <param name="links">
                                                            <param name="*">
                                                                wildfire_overview?earliest=$earliest$&amp;latest=$latest$&amp;form.dst_user=$click.value$
                                                            </param>
                                                        </param>
                                                    </module>
                                                </module>
                                            </module>
                                        </module>
                                        <module name="HiddenSearch" layoutPanel="panel_row5_col1">
                                            <param name="search">| tstats count(src_ip) AS csrc FROM pan_wildfire WHERE * category="malicious" $src_ip$ $dst_ip$ $dst_user$ $misc$ $vsys$ $app$ groupby src_ip</param>
                                            <module name="HiddenChartFormatter">
                                                <param name="chartTitle">Top Malware Sources</param>
                                                <param name="chart">pie</param>
                                                <param name="legend.placement">bottom</param>
                                                <module name="JSChart">
                                                    <param name="width">100%</param>
                                                    <param name="height">250px</param>
                                                    <module name="SimpleDrilldown">
                                                        <param name="links">
                                                            <param name="*">
                                                                wildfire_overview?earliest=$earliest$&amp;latest=$latest$&amp;form.src_ip=$click.value$
                                                            </param>
                                                        </param>
                                                    </module>
                                                </module>
                                            </module>
                                        </module>
                                        <module name="HiddenSearch" layoutPanel="panel_row5_col2">
                                          <param name="search">|`tstats` count(action) AS cact FROM pan_wildfire WHERE * category="malicious" (action=wildfire-upload-success OR action=wildfire-upload-skip) $src_ip$ $dst_ip$ $dst_user$ $misc$ $vsys$ $app$ groupby action |
                                            replace wildfire-upload-success with "New Sample" in action |
                                            replace wildfire-upload-skip with "Known" in action
                                            </param>
                                            <module name="HiddenChartFormatter">
                                                <param name="chartTitle">Previously Analyzed Malware</param>
                                                <param name="chart">pie</param>
                                                <param name="legend.placement">bottom</param>
                                                <module name="JSChart">
                                                    <param name="width">100%</param>
                                                    <param name="height">250px</param>
                                                  <module name="SimpleDrilldown">
                                                    <param name="links">
                                                      <!--param name="*">flashtimeline?earliest=$earliest$&amp;latest=$latest$&amp;q=`pan_wildfire` severity="$click.value$"</param-->
                                                      <param name="*">./flashtimeline?earliest=$earliest$&amp;latest=$latest$&amp;q=`pan_index` action="$click.value$"
                                                      </param>
                                                    </param>
                                                  </module>
                                                </module>
                                            </module>
                                        </module>
                                        <module name="HiddenSearch" layoutPanel="panel_row5_col3">
                                            <param name="search">| tstats count(dst_ip) AS cti FROM pan_wildfire WHERE * category="malicious" $src_ip$ $dst_ip$ $dst_user$ $misc$ $vsys$ $app$ groupby dst_ip</param>
                                            <module name="HiddenChartFormatter">
                                                <param name="chartTitle">Top Malware Downloaders by IP</param>
                                                <param name="chart">pie</param>
                                                <param name="legend.placement">bottom</param>
                                                <module name="JSChart">
                                                    <param name="width">100%</param>
                                                    <param name="height">250px</param>
                                                    <module name="SimpleDrilldown">
                                                        <param name="links">
                                                            <param name="*">
                                                                wildfire_overview?earliest=$earliest$&amp;latest=$latest$&amp;form.dst_ip=$click.value$
                                                            </param>
                                                        </param>
                                                    </module>
                                                </module>
                                            </module>
                                        </module>
                                        <module name="HiddenSearch" layoutPanel="panel_row3_col1" group="Possible Malware Traffic">
                                          <param name="search"> |`tstats` count(dst_ip) AS cdip FROM pan_wildfire_report_malware_traffic WHERE * NOT (protocol=udp AND dst_port=53) groupby dst_ip dst_port report_id protocol | table report_id dst_ip dst_port protocol |
                                            join protocol dst_ip dst_port [ |`tstats` count(src_ip) FROM pan_traffic WHERE * NOT (protocol=udp AND dst_port=53) groupby _time src_ip dst_ip dst_port protocol src_user | table _time src_ip src_user dst_port dst_ip protocol | rename _time AS traffic_time ] |
                                            rename src_user AS "User" | rename src_ip AS "Compromised IP" |
                                            join type=left report_id [|`tstats` count(report_id) AS crid FROM pan_wildfire WHERE * groupby report_id misc | table report_id misc ] |
                                            table traffic_time "Compromised IP" "User" misc dst_ip dst_port protocol |
                                            rename traffic_time AS _time |
                                            rename misc AS "Malware File" |
                                            rename dst_ip AS "Traffic Dst_IP" |
                                            rename dst_port AS "Traffic Dst_Port" |
                                            rename protocol AS "Protocol"</param>
                                            <module name="Paginator">
                                                <param name="count">10</param>
                                                <param name="entityName">results</param>
                                                <module name="SimpleResultsTable">
                                                  <param name="allowTransformedFieldSelect">True</param>
                                                  <param name="drilldown">all</param>
                                                  <module name="SimpleDrilldown">
                                                    <param name="links">
                                                      <param name="*">./flashtimeline?earliest=$earliest$&amp;latest=$latest$&amp;q=`pan_index` src_user="$row.User$" src_ip="$row.Compromised IP$" dst_ip="$row.Traffic Dst_IP$" dst_port="$row.Traffic Dst_Port$" protocol="$row.Protocol$"</param>
                                                    </param>
                                                  </module>
                                                </module>
                                            </module>
                                          <module name="StaticContentSample" layoutPanel="panel_row3_col1">
                                            <param name="text">These hosts attempted a connection to servers known to be accessed by malware programs detected by the firewall. These hosts may be compromised as they show network behavior consistent with an analyzed malware sample. This data is based on a correlation of traffic logs and malware network behavior from WildFire Cloud analysis reports.  (Note: This correlation requires a <![CDATA[<a href="http://localhost:8000/en-US/manager/SplunkforPaloAltoNetworks/apps/local/SplunkforPaloAltoNetworks/setup?action=edit">WildFire API Key</a>]]>)
                                            </param>
                                          </module>
                                        </module>
                                </module>
                            </module>
                        </module>
                    </module>
                </module>
            </module>
        </module>
</view>
